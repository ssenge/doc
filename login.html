<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-en="Login - TRT Clinic" data-de="Anmelden - TRT Clinic">Login - TRT Clinic</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/css/custom.css">
</head>
<body class="bg-gray-50">
    <div id="header"></div>
    <!-- Login/Register Content -->
    <section class="bg-gray-50 py-8 lg:py-16">
        <div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
            <div class="sm:mx-auto sm:w-full sm:max-w-md">
                <div class="text-center">
                    <h1 class="text-3xl font-bold text-gray-900" data-en="TRT Clinic" data-de="TRT Klinik">TRT Clinic</h1>
                    <p class="mt-2 text-sm text-gray-600" data-en="Professional Testosterone Replacement Therapy" data-de="Professionelle Testosteron-Ersatztherapie">Professional Testosterone Replacement Therapy</p>
                </div>
            </div>

            <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
                <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
                    
                    <!-- Login Form -->
                    <div id="loginForm">
                        <h2 class="text-2xl font-bold text-gray-900 text-center mb-6" data-en="Login to Your Account" data-de="In Ihr Konto einloggen">Login to Your Account</h2>
                        
                        <form id="loginFormElement" class="space-y-6">
                            <div>
                                <label for="loginEmail" class="block text-sm font-medium text-gray-700" data-en="Email" data-de="E-Mail">Email</label>
                                <input id="loginEmail" name="email" type="email" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>

                            <div>
                                <label for="loginPassword" class="block text-sm font-medium text-gray-700" data-en="Password" data-de="Passwort">Password</label>
                                <input id="loginPassword" name="password" type="password" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>

                            <div>
                                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <span data-en="Sign In" data-de="Anmelden">Sign In</span>
                                </button>
                            </div>
                        </form>

                        <!-- Success/Error Messages -->
                        <div id="loginSuccess" class="hidden mt-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded"></div>
                        <div id="loginError" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"></div>
                        
                        <!-- Forgot Password -->
                        <div class="mt-6 text-center">
                            <button onclick="showForgotPassword()" class="text-sm text-blue-600 hover:text-blue-500" data-en="Forgot your password?" data-de="Passwort vergessen?">
                                Forgot your password?
                            </button>
                        </div>
                    </div>

                    <!-- New Account Information -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <div class="text-center">
                            <h3 class="text-lg font-medium text-gray-900 mb-3" data-en="Don't have an account?" data-de="Noch kein Konto?">Don't have an account?</h3>
                            
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3 text-left">
                                        <p class="text-sm text-blue-800" data-en="Accounts are created automatically when you complete a treatment order. This ensures all your information is properly collected and your order is linked to your account." data-de="Konten werden automatisch erstellt, wenn Sie eine Behandlungsbestellung abschließen. Dadurch wird sichergestellt, dass alle Ihre Informationen ordnungsgemäß erfasst und Ihre Bestellung mit Ihrem Konto verknüpft wird.">
                                            Accounts are created automatically when you complete a treatment order. This ensures all your information is properly collected and your order is linked to your account.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <p class="text-sm text-gray-600" data-en="To create an account:" data-de="Um ein Konto zu erstellen:">To create an account:</p>
                                
                                <div class="flex flex-col sm:flex-row gap-2">
                                    <a href="assessment.html" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors text-center font-medium">
                                        <span data-en="1. Start Health Assessment" data-de="1. Gesundheitsbewertung starten">1. Start Health Assessment</span>
                                    </a>
                                    <a href="treatments.html" class="flex-1 bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 transition-colors text-center font-medium">
                                        <span data-en="2. Choose Treatment" data-de="2. Behandlung wählen">2. Choose Treatment</span>
                                    </a>
                                </div>
                                
                                <p class="text-xs text-gray-500" data-en="After payment, you'll be prompted to set a password and your account will be created with all your details." data-de="Nach der Zahlung werden Sie aufgefordert, ein Passwort festzulegen, und Ihr Konto wird mit all Ihren Daten erstellt.">
                                    After payment, you'll be prompted to set a password and your account will be created with all your details.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Forgot Password Form (Hidden by default) -->
                    <div id="forgotPasswordForm" class="hidden">
                        <h2 class="text-2xl font-bold text-gray-900 text-center mb-6" data-en="Reset Password" data-de="Passwort zurücksetzen">Reset Password</h2>
                        
                        <form id="forgotPasswordFormElement" class="space-y-6">
                            <div>
                                <label for="resetEmail" class="block text-sm font-medium text-gray-700" data-en="Email" data-de="E-Mail">Email</label>
                                <input id="resetEmail" name="email" type="email" required class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>

                            <div>
                                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <span data-en="Send Reset Link" data-de="Reset-Link senden">Send Reset Link</span>
                                </button>
                            </div>
                        </form>

                        <!-- Success/Error Messages -->
                        <div id="resetSuccess" class="hidden mt-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded"></div>
                        <div id="resetError" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"></div>
                        
                        <!-- Back to Login -->
                        <div class="mt-6 text-center">
                            <button onclick="showLoginForm()" class="text-sm text-blue-600 hover:text-blue-500" data-en="Back to Login" data-de="Zurück zur Anmeldung">
                                Back to Login
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div id="footer"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
    <script src="assets/js/language.js?v=3.0"></script>
    <script src="assets/js/config.js?v=3.0"></script>
    <script src="assets/js/supabase-client.js?v=3.0"></script>
    <script src="assets/js/header.js?v=3.0"></script>
    <script src="assets/js/footer.js?v=3.0"></script>
    <script>
        // Form handling
        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('forgotPasswordForm').classList.add('hidden');
        }

        function showForgotPassword() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('forgotPasswordForm').classList.remove('hidden');
        }

        // Handle login form submission
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const button = event.target.querySelector('button[type="submit"]');
            const errorDiv = document.getElementById('loginError');
            const successDiv = document.getElementById('loginSuccess');
            
            // Clear previous messages
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
            
            // Show loading state
            button.disabled = true;
            button.innerHTML = '<span data-en="Signing in..." data-de="Wird angemeldet...">Signing in...</span>';
            
            try {
                // Wait for Supabase to be ready
                await waitForSupabase();
                
                const result = await window.eDocAuth.signIn(email, password);
                
                if (result.success) {
                    showSuccess('loginSuccess', 'Login successful! Redirecting...');
                    
                    // Redirect to return URL or dashboard
                    const urlParams = new URLSearchParams(window.location.search);
                    const returnUrl = urlParams.get('return') || 'dashboard.html';
                    
                    setTimeout(() => {
                        window.location.href = returnUrl;
                    }, 1000);
                } else {
                    showError('loginError', result.error);
                }
            } catch (error) {
                showError('loginError', 'An unexpected error occurred. Please try again.');
                console.error('Login error:', error);
            } finally {
                // Reset button
                button.disabled = false;
                button.innerHTML = '<span data-en="Sign In" data-de="Anmelden">Sign In</span>';
            }
        }

        // Handle forgot password form submission
        async function handleForgotPassword(event) {
            event.preventDefault();
            
            const email = document.getElementById('resetEmail').value;
            const button = event.target.querySelector('button[type="submit"]');
            const errorDiv = document.getElementById('resetError');
            const successDiv = document.getElementById('resetSuccess');
            
            // Clear previous messages
            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
            
            // Validate email
            if (!window.eDocUtils?.validateEmail(email)) {
                showError('resetError', 'Please enter a valid email address');
                return;
            }
            
            // Show loading state
            button.disabled = true;
            button.innerHTML = '<span data-en="Sending..." data-de="Wird gesendet...">Sending...</span>';
            
            try {
                // Wait for Supabase to be ready
                await waitForSupabase();
                
                const result = await window.eDocAuth.resetPassword(email);
                
                if (result.success) {
                    showSuccess('resetSuccess', 'Password reset link sent! Please check your email.');
                } else {
                    showError('resetError', result.error);
                }
            } catch (error) {
                showError('resetError', 'An unexpected error occurred. Please try again.');
                console.error('Password reset error:', error);
            } finally {
                // Reset button
                button.disabled = false;
                button.innerHTML = '<span data-en="Send Reset Link" data-de="Reset-Link senden">Send Reset Link</span>';
            }
        }

        // Utility functions
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function waitForSupabase() {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const maxAttempts = 50;
                
                const checkSupabase = () => {
                    attempts++;
                    if (window.eDocAuth && window.eDocDatabase && window.eDocSupabase) {
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        reject(new Error('Timeout waiting for Supabase'));
                    } else {
                        setTimeout(checkSupabase, 100);
                    }
                };
                checkSupabase();
            });
        }

        // Add form event listeners when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add login form handler
            const loginForm = document.getElementById('loginFormElement');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            // Add forgot password form handler
            const forgotPasswordForm = document.getElementById('forgotPasswordFormElement');
            if (forgotPasswordForm) {
                forgotPasswordForm.addEventListener('submit', handleForgotPassword);
            }
            
            // Language system initializes automatically - no need to call init()
        });
    </script>
</body>
</html> 